[gd_scene load_steps=27 format=3 uid="uid://c2i1ufdjor4ks"]

[ext_resource type="Texture2D" uid="uid://chbqvnk34gr0o" path="res://Assets/Textures/KennyTextures/Vector/texture_02.svg" id="1_4a100"]
[ext_resource type="Script" path="res://Scripts/WorldScripts/MainScene.gd" id="1_5cs7q"]
[ext_resource type="PackedScene" uid="uid://b8ds1i6ivs72m" path="res://Scenes/PlayerScenes/Player.tscn" id="5_rrdk8"]
[ext_resource type="PackedScene" uid="uid://d31jlldr5f2ur" path="res://Scenes/InventoryScenes/inventory.tscn" id="6_4iapt"]
[ext_resource type="Script" path="res://Scripts/InventoryScripts/inventory_data_equip.gd" id="7_1uk4m"]
[ext_resource type="Script" path="res://Scripts/InventoryScripts/inventory_interface.gd" id="8_f7wt2"]
[ext_resource type="PackedScene" uid="uid://c15dj2v3hj7v7" path="res://Scenes/InventoryScenes/slot.tscn" id="9_s8q51"]
[ext_resource type="PackedScene" uid="uid://c84aqtgi023wn" path="res://Scenes/InventoryScenes/chest.tscn" id="10_6y0in"]
[ext_resource type="PackedScene" uid="uid://qqumu3s5wreb" path="res://Scenes/InventoryScenes/hot_bar_inventory.tscn" id="10_f1dae"]
[ext_resource type="Script" path="res://Scripts/InventoryScripts/Inventory_Data.gd" id="11_a61a3"]
[ext_resource type="Resource" uid="uid://d34ne0v0t4rqs" path="res://Inventory/Items/Apple.tres" id="12_8i5ey"]
[ext_resource type="PackedScene" uid="uid://bxvhhys4mbmqu" path="res://Scenes/WorldScenes/pause_menu.tscn" id="12_iwgat"]
[ext_resource type="Script" path="res://Scripts/InventoryScripts/Slot_Data.gd" id="13_q3p3q"]
[ext_resource type="Resource" uid="uid://wnnjclxymmkg" path="res://Inventory/Items/Blue_Book.tres" id="14_6f7nx"]
[ext_resource type="MeshLibrary" uid="uid://mb2j5k7fbyw3" path="res://Assets/Meshes/tiles.tres" id="15_iwti7"]

[sub_resource type="Environment" id="Environment_4s7r7"]
sdfgi_enabled = true
fog_enabled = true
fog_density = 0.005

[sub_resource type="CameraAttributesPhysical" id="CameraAttributesPhysical_frsjj"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_t2bas"]
albedo_texture = ExtResource("1_4a100")
uv1_triplanar = true

[sub_resource type="Resource" id="Resource_7qfmd"]
script = ExtResource("7_1uk4m")
slot_datas = Array[ExtResource("13_q3p3q")]([null, null, null, null])

[sub_resource type="Resource" id="Resource_oonjo"]
script = ExtResource("13_q3p3q")
item_data = ExtResource("12_8i5ey")
quantity = 83

[sub_resource type="Resource" id="Resource_7eose"]
script = ExtResource("13_q3p3q")
item_data = ExtResource("12_8i5ey")
quantity = 4

[sub_resource type="Resource" id="Resource_jp227"]
script = ExtResource("13_q3p3q")
item_data = ExtResource("12_8i5ey")
quantity = 7

[sub_resource type="Resource" id="Resource_7y4tl"]
script = ExtResource("13_q3p3q")
item_data = ExtResource("14_6f7nx")
quantity = 1

[sub_resource type="Resource" id="Resource_lxuya"]
script = ExtResource("11_a61a3")
slot_datas = Array[ExtResource("13_q3p3q")]([SubResource("Resource_oonjo"), SubResource("Resource_7eose"), SubResource("Resource_jp227"), SubResource("Resource_7y4tl"), null])

[sub_resource type="PhysicsMaterial" id="PhysicsMaterial_sabnf"]

[sub_resource type="GDScript" id="GDScript_ko6kn"]
script/source = "extends GridMap

@export var width := 25
@export var height := 25
@export var depth := 25
@export var fill_percent := 0.56
@export var num_of_blocks_near := 8
@export var max_num_of_blocks_near := 14

func _ready() -> void:
	randomize()
	make_caves()
	make_walls()
	random_fill()

func random_fill() -> void:
	for x in width:
		for y in height:
			for z in depth:
				if randf() > fill_percent:
					set_cell_item(Vector3i(x, y, z), 1, 1)
				else:
					set_cell_item(Vector3i(x, y, z), 0, 1)

func make_walls() -> void:
	for x in width:
		set_cell_item(Vector3i(x, 0, 1), 0, 1)
		set_cell_item(Vector3i(x, height - 1, 1), 0, 1)
	for y in height:
		set_cell_item(Vector3i(0, y, 1), 0, 1)
		set_cell_item(Vector3i(width - 1, y, 1), 0, 1)
	for z in depth:
		set_cell_item(Vector3i(0, 1, z), 0, 1)
		set_cell_item(Vector3i(width - 1, height - 1, z), 0, 1)

func make_caves() -> void:
	print(\"ran\")
	for x in range(3, width-3, 3):
		for y in range(3, height-3, 3):
			for z in range(3, 3, depth-3):
				var count := 0
				print(count)
				# Left wall. From looking at -z (character looking pos)
				if get_cell_item(Vector3i(x-1,y-1,z-1)) == 1: count += 1
				if get_cell_item(Vector3i(x-1,y-1,z)) == 1: count += 1
				if get_cell_item(Vector3i(x-1,y-1,z+1)) == 1: count += 1
				if get_cell_item(Vector3i(x-1,y,z-1)) == 1: count += 1
				if get_cell_item(Vector3i(x-1,y,z)) == 1: count += 1
				if get_cell_item(Vector3i(x-1,y,z+1)) == 1: count += 1
				if get_cell_item(Vector3i(x-1,y+1,z-1)) == 1: count += 1
				if get_cell_item(Vector3i(x-1,y+1,z)) == 1: count += 1
				if get_cell_item(Vector3i(x-1,y+1,z+1)) == 1: count += 1
				# Right wall
				if get_cell_item(Vector3i(x+1,y-1,z-1)) == 1: count += 1
				if get_cell_item(Vector3i(x+1,y-1,z)) == 1: count += 1
				if get_cell_item(Vector3i(x+1,y-1,z+1)) == 1: count += 1
				if get_cell_item(Vector3i(x+1,y,z-1)) == 1: count += 1
				if get_cell_item(Vector3i(x+1,y,z)) == 1: count += 1
				if get_cell_item(Vector3i(x+1,y,z+1)) == 1: count += 1
				if get_cell_item(Vector3i(x+1,y+1,z-1)) == 1: count += 1
				if get_cell_item(Vector3i(x+1,y+1,z)) == 1: count += 1
				if get_cell_item(Vector3i(x+1,y+1,z+1)) == 1: count += 1
				# Top row
				if get_cell_item(Vector3i(x, y+1, z-1)) == 1: count += 1
				if get_cell_item(Vector3i(x, y+1, z)) == 1: count += 1
				if get_cell_item(Vector3i(x, y+1, z+1)) == 1: count += 1
				# Bottom row
				if get_cell_item(Vector3i(x, y-1, z-1)) == 1: count += 1
				if get_cell_item(Vector3i(x, y-1, z)) == 1: count += 1
				if get_cell_item(Vector3i(x, y-1, z+1)) == 1: count += 1
				# Front and back last slots
				if get_cell_item(Vector3i(x, y, z-1)) == 1: count += 1
				if get_cell_item(Vector3i(x, y, z+1)) == 1: count += 1
				if count < num_of_blocks_near:
					set_cell_item(Vector3i(x, y, z), 1, 1)
				if count >= max_num_of_blocks_near:
					set_cell_item(Vector3i(x, y, z), 0, 1)
				print(count)
"

[node name="World" type="Node3D"]
process_mode = 3
script = ExtResource("1_5cs7q")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(-0.866025, -0.433013, 0.25, 0, 0.5, 0.866025, -0.5, 0.75, -0.433013, 0, 0, 0)
shadow_enabled = true

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_4s7r7")
camera_attributes = SubResource("CameraAttributesPhysical_frsjj")

[node name="Map" type="Node3D" parent="."]

[node name="Floor" type="CSGBox3D" parent="Map"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.5, 0)
material_override = SubResource("StandardMaterial3D_t2bas")
use_collision = true
size = Vector3(100, 1, 100)

[node name="Player" parent="." instance=ExtResource("5_rrdk8")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -1.63756)
sens_horizontal = 0.2
sens_vertical = 0.2
equip_inventory_data = SubResource("Resource_7qfmd")

[node name="UI" type="CanvasLayer" parent="."]

[node name="InventoryInterface" type="Control" parent="UI"]
visible = false
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = ExtResource("8_f7wt2")
metadata/_edit_use_anchors_ = true

[node name="PlayerInventory" parent="UI/InventoryInterface" instance=ExtResource("6_4iapt")]
layout_mode = 0
offset_left = 10.0
offset_top = 10.0
offset_right = 50.0
offset_bottom = 50.0

[node name="EquipInventory" parent="UI/InventoryInterface" instance=ExtResource("6_4iapt")]
layout_mode = 0
offset_left = 800.0
offset_top = 10.0
offset_right = 840.0
offset_bottom = 50.0

[node name="ExternalInventory" parent="UI/InventoryInterface" instance=ExtResource("6_4iapt")]
visible = false
layout_mode = 0
offset_left = 10.0
offset_top = 320.0
offset_right = 50.0
offset_bottom = 360.0

[node name="GrabbedSlot" parent="UI/InventoryInterface" instance=ExtResource("9_s8q51")]
visible = false
modulate = Color(1, 1, 1, 0.490196)
self_modulate = Color(1, 1, 1, 0)
layout_mode = 0
offset_right = 64.0
offset_bottom = 64.0

[node name="HotBarInventory" parent="UI" instance=ExtResource("10_f1dae")]
offset_left = 10.0
offset_top = 10.0
offset_right = 50.0
offset_bottom = 50.0

[node name="PauseMenu" parent="UI" instance=ExtResource("12_iwgat")]
visible = false

[node name="Chest" parent="." instance=ExtResource("10_6y0in")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -6)
inventory_data = SubResource("Resource_lxuya")

[node name="WorldGrid" type="GridMap" parent="."]
mesh_library = ExtResource("15_iwti7")
physics_material = SubResource("PhysicsMaterial_sabnf")
cell_size = Vector3(1, 1, 1)
script = SubResource("GDScript_ko6kn")
metadata/_editor_floor_ = Vector3(0, 0, 0)

[connection signal="drop_slot_data" from="UI/InventoryInterface" to="." method="_on_inventory_interface_drop_slot_data"]
[connection signal="gui_input" from="UI/InventoryInterface" to="UI/InventoryInterface" method="_on_gui_input"]
[connection signal="visibility_changed" from="UI/InventoryInterface" to="UI/InventoryInterface" method="_on_visibility_changed"]
